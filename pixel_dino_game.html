<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dino Runner</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        * {
            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
            image-rendering: pixelated;
        }

        body {
            font-family: 'Press Start 2P', monospace;
            text-align: center;
            background: linear-gradient(45deg, #2a5298 0%, #1e3c72 50%, #2a5298 100%);
            background-size: 400% 400%;
            animation: gradient-shift 8s ease infinite;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            color: #ffffff;
            overflow: hidden;
        }

        html {
            overflow: hidden;
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        h1 {
            color: #ffeb3b;
            margin-bottom: 30px;
            font-size: 24px;
            text-shadow: 3px 3px 0px #d32f2f, 6px 6px 0px #b71c1c;
            animation: title-pulse 2s ease-in-out infinite alternate;
        }

        @keyframes title-pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.05); }
        }

        #title-screen {
            max-width: 600px;
            margin: 0 auto;
            background: #3e2723;
            padding: 30px;
            border: 4px solid #8d6e63;
            border-radius: 0;
            box-shadow: 
                inset 2px 2px 0px #5d4037,
                inset -2px -2px 0px #1b0000,
                4px 4px 0px #000000;
        }

        #title-screen h2 {
            color: #ffeb3b;
            font-size: 16px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0px #f57f17;
        }

        #high-score-display {
            font-size: 14px;
            font-weight: normal;
            color: #fff;
            margin: 20px 0;
            padding: 15px;
            background: #d32f2f;
            border: 2px solid #b71c1c;
            box-shadow: inset 2px 2px 0px #f44336, inset -2px -2px 0px #b71c1c;
            text-shadow: 1px 1px 0px #000000;
        }

        #character-select {
            margin-bottom: 20px;
        }

        #character-select h3 {
            color: #ffeb3b;
            margin-bottom: 10px;
            font-size: 12px;
            text-shadow: 1px 1px 0px #f57f17;
        }

        #leaderboard {
            background: #4a4a4a;
            border: 3px solid #616161;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 
                inset 2px 2px 0px #757575,
                inset -2px -2px 0px #212121;
        }

        #leaderboard h3 {
            color: #ffeb3b;
            margin-top: 0;
            font-size: 12px;
            text-shadow: 1px 1px 0px #f57f17;
        }

        .score-entry {
            background: #2e2e2e;
            margin: 8px 0;
            padding: 12px;
            border: 2px solid #424242;
            border-left: 6px solid #4caf50;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: inset 1px 1px 0px #616161, inset -1px -1px 0px #000000;
            font-size: 10px;
        }

        .score-entry:first-child {
            border-left-color: #ffeb3b;
            background: #3e2723;
            box-shadow: inset 1px 1px 0px #5d4037, inset -1px -1px 0px #1b0000;
        }

        .score-entry:nth-child(2) {
            border-left-color: #9e9e9e;
            background: #333333;
        }

        .score-entry:nth-child(3) {
            border-left-color: #ff9800;
            background: #2d2d2d;
        }

        .score-rank {
            font-weight: normal;
            margin-right: 10px;
            color: #ffeb3b;
        }

        .score-value {
            font-weight: normal;
            color: #ffffff;
        }

        #game-container {
            max-width: 600px;
            margin: 0 auto;
            overflow: hidden;
        }

        #back-to-menu {
            margin-top: 15px;
            padding: 12px 24px;
            background: #1976d2;
            color: white;
            border: 3px solid #0d47a1;
            border-radius: 0;
            cursor: pointer;
            font-size: 10px;
            font-family: 'Press Start 2P', monospace;
            box-shadow: 
                inset 2px 2px 0px #2196f3,
                inset -2px -2px 0px #0d47a1,
                2px 2px 0px #000000;
            transition: all 0.1s;
        }

        #back-to-menu:hover {
            background: #1565c0;
            transform: translate(1px, 1px);
            box-shadow: 
                inset 2px 2px 0px #1976d2,
                inset -2px -2px 0px #0d47a1,
                1px 1px 0px #000000;
        }

        #back-to-menu:active {
            transform: translate(2px, 2px);
            box-shadow: 
                inset 2px 2px 0px #0d47a1,
                inset -2px -2px 0px #000051;
        }

        #game-area {
            width: 600px;
            height: 200px;
            border: 4px solid #5d4037;
            margin: 20px auto;
            position: relative;
            overflow: hidden;
            background: none;
            box-shadow: 
                inset 2px 2px 0px #8d6e63,
                inset -2px -2px 0px #3e2723,
                4px 4px 0px #000000;
        }

        .bg-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        .bg-sky {
            background: linear-gradient(to bottom, var(--sky-color1, #87ceeb) 0%, var(--sky-color2, #87ceeb) 30%, var(--ground-color, #deb887) 30%, var(--ground-color, #deb887) 100%);
            transition: background 2s linear;
        }
        .bg-clouds {
            background: none;
        }
        .bg-night {
            background: rgba(20,30,60,0.35);
            opacity: 0;
            transition: opacity 2s linear;
        }
        .bg-night.active {
            opacity: 1;
        }
        .cloud {
            position: absolute;
            width: 48px; height: 24px;
            background: url('data:image/svg+xml;utf8,<svg width="48" height="24" xmlns="http://www.w3.org/2000/svg"><ellipse cx="12" cy="12" rx="12" ry="8" fill="white"/><ellipse cx="28" cy="10" rx="10" ry="7" fill="white"/><ellipse cx="38" cy="14" rx="8" ry="6" fill="white"/></svg>') no-repeat center/contain;
            opacity: 0.7;
        }

        #game-area::before,
        #game-area::after {
            display: none !important;
        }

        #dino {
            width: 40px;
            height: 50px;
            position: absolute;
            bottom: 30px;
            left: 50px;

            background-image: url('data:image/svg+xml,%3Csvg width="40" height="50" xmlns="http://www.w3.org/2000/svg"%3E%3Cstyle%3Erect %7B fill: %23228B22; %7D%3C/style%3E%3Crect x="0" y="20" width="5" height="5"/%3E%3Crect x="5" y="25" width="5" height="5"/%3E%3Crect x="5" y="15" width="20" height="15"/%3E%3Crect x="10" y="30" width="5" height="20"/%3E%3Crect x="20" y="30" width="5" height="20"/%3E%3Crect x="25" y="10" width="5" height="10"/%3E%3Crect x="25" y="0" width="15" height="10"/%3E%3Crect x="35" y="2" width="3" height="3" fill="%23FFF"/%3E%3Crect x="38" y="6" width="2" height="2" fill="%23000"/%3E%3C/svg%3E');
            background-repeat: no-repeat;
            background-size: contain;

            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
            image-rendering: pixelated;
        }

        /* Dylan's contribution */
        .jump {
            animation-name: jump-up-animation, jump-down-animation;
            animation-duration: 0.27s, 0.23s;
            animation-timing-function: ease-out, ease-in;
            animation-delay: 0s, .27s;
        }

        @keyframes jump-up-animation {
            0% { bottom: 30px; }
            100% { bottom: 130px; }
        }

        @keyframes jump-down-animation {
            0% { bottom: 130px; }
            100% { bottom: 30px; }
        }

        #obstacle {
            background-repeat: no-repeat;
            background-size: contain;

            position: absolute;
            bottom: 30px;
            animation: obstacle-move 2s linear infinite;

            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
            image-rendering: pixelated;
        }

        @keyframes obstacle-move {
            0% { right: -100px; }
            100% { right: 650px; }
        }

        #score {
            margin-top: 15px;
            font-size: 12px;
            color: #ffeb3b;
            text-shadow: 2px 2px 0px #f57f17;
            background: #3e2723;
            display: inline-block;
            padding: 10px 20px;
            border: 2px solid #8d6e63;
            box-shadow: inset 1px 1px 0px #5d4037, inset -1px -1px 0px #1b0000;
        }

        #game-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ff1744;
            text-align: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            visibility: hidden;
            text-shadow: 
                2px 2px 0px #000,
                -2px -2px 0px #000,
                2px -2px 0px #000,
                -2px 2px 0px #000;
            animation: game-over-fade 0.5s ease-out forwards;
        }

        @keyframes game-over-fade {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        #game-overlay.show {
            visibility: visible;
            opacity: 1;
        }

        #game-overlay .game-over-text {
            font-size: 24px;
            margin-bottom: 10px;
            color: #ff1744;
        }

        #game-overlay .game-over-score {
            font-size: 16px;
            color: #ffeb3b;
            margin-bottom: 8px;
        }

        #game-overlay .game-over-message {
            font-size: 12px;
            color: #ffffff;
        }

        #credits {
            position: fixed;
            bottom: 10px;
            left: 10px;
            font-size: 10px;
            color: #ffeb3b;
            text-shadow: 1px 1px 0px #000;
            opacity: 0.7;
            transition: opacity 0.3s;
        }

        #credits:hover {
            opacity: 1;
        }

        #milestone-popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) translateY(-20px);
            color: #ffeb3b;
            text-align: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            visibility: hidden;
            text-shadow: 
                2px 2px 0px #f57f17,
                -1px -1px 0px #000,
                1px -1px 0px #000,
                -1px 1px 0px #000,
                1px 1px 0px #000;
        }

        #milestone-popup.animate {
            visibility: visible;
            animation: float-up 2s ease-out forwards;
        }

        @keyframes float-up {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) translateY(-20px);
            }
            20% {
                opacity: 1;
                transform: translate(-50%, -50%) translateY(-20px);
            }
            80% {
                opacity: 1;
                transform: translate(-50%, -50%) translateY(-60px);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) translateY(-60px);
            }
        }

        .achievement-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #4CAF50;
            padding: 10px;
            border-radius: 0;
            color: white;
            z-index: 1000;
            font-family: 'Press Start 2P', monospace;
            font-size: 8px;
            text-align: center;
            transform: translateX(120%);
            transition: transform 0.3s ease-in-out;
            text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.5);
            image-rendering: pixelated;
            max-width: 200px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .achievement-popup.show {
            transform: translateX(0);
        }

        .achievement-popup h3 {
            color: #4CAF50;
            margin: 0 0 5px 0;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .achievement-popup p {
            margin: 0;
            font-size: 8px;
            line-height: 1.4;
            opacity: 0.9;
        }

        .character-unlock-popup {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ffd700;
            padding: 10px;
            border-radius: 0;
            color: white;
            z-index: 1000;
            font-family: 'Press Start 2P', monospace;
            font-size: 8px;
            text-align: center;
            transform: translateX(120%);
            transition: transform 0.3s ease-in-out;
            text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.5);
            image-rendering: pixelated;
            max-width: 200px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .character-unlock-popup.show {
            transform: translateX(0);
        }

        .character-unlock-popup h3 {
            color: #ffd700;
            margin: 0 0 5px 0;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .character-unlock-popup p {
            margin: 0;
            font-size: 8px;
            line-height: 1.4;
            opacity: 0.9;
        }

        .character-unlock-popup .character-icon {
            width: 32px;
            height: 32px;
            margin: 5px auto;
            image-rendering: pixelated;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .character-option {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #8d6e63;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .character-option.unlocked:hover {
            border-color: #ffeb3b;
            transform: scale(1.05);
        }

        .character-option.selected {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.2);
            box-shadow: 0 0 10px #4CAF50;
        }

        .character-option.locked {
            opacity: 0.7;
            cursor: help;
        }

        .character-locked {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: #ffeb3b;
        }

        .character-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ffeb3b;
            padding: 10px;
            border-radius: 5px;
            color: white;
            font-size: 12px;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 1000;
            text-align: center;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .character-option.locked:hover .character-tooltip {
            opacity: 1;
        }

        .character-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 5px;
            border-style: solid;
            border-color: #ffeb3b transparent transparent transparent;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        @keyframes popIn {
            from { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        #start-game {
            margin-top: 20px;
            padding: 15px 30px;
            background: #4CAF50;
            color: white;
            border: 3px solid #2E7D32;
            border-radius: 0;
            cursor: pointer;
            font-size: 14px;
            font-family: 'Press Start 2P', monospace;
            box-shadow: 
                inset 2px 2px 0px #66BB6A,
                inset -2px -2px 0px #1B5E20,
                2px 2px 0px #000000;
            transition: all 0.1s;
        }

        #start-game:disabled {
            background: #9E9E9E;
            border-color: #616161;
            cursor: not-allowed;
            box-shadow: 
                inset 2px 2px 0px #BDBDBD,
                inset -2px -2px 0px #424242,
                2px 2px 0px #000000;
        }

        #start-game:not(:disabled):hover {
            background: #43A047;
            transform: translate(1px, 1px);
            box-shadow: 
                inset 2px 2px 0px #4CAF50,
                inset -2px -2px 0px #1B5E20,
                1px 1px 0px #000000;
        }

        #start-game:not(:disabled):active {
            transform: translate(2px, 2px);
            box-shadow: 
                inset 2px 2px 0px #1B5E20,
                inset -2px -2px 0px #000051;
        }

        .menu-button {
            margin: 10px;
            padding: 12px 24px;
            background: #1976d2;
            color: white;
            border: 3px solid #0d47a1;
            border-radius: 0;
            cursor: pointer;
            font-size: 12px;
            font-family: 'Press Start 2P', monospace;
            box-shadow: 
                inset 2px 2px 0px #2196f3,
                inset -2px -2px 0px #0d47a1,
                2px 2px 0px #000000;
            transition: all 0.1s;
        }

        .menu-button:hover {
            background: #1565c0;
            transform: translate(1px, 1px);
            box-shadow: 
                inset 2px 2px 0px #1976d2,
                inset -2px -2px 0px #0d47a1,
                1px 1px 0px #000000;
        }

        .menu-button:active {
            transform: translate(2px, 2px);
            box-shadow: 
                inset 2px 2px 0px #0d47a1,
                inset -2px -2px 0px #000051;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #3e2723;
            padding: 30px;
            border: 4px solid #8d6e63;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            color: #ffeb3b;
            cursor: pointer;
            text-shadow: 2px 2px 0px #000;
        }

        .achievement-list {
            display: grid;
            gap: 10px;
            margin-top: 20px;
        }

        .achievement-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border: 2px solid #8d6e63;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .achievement-item.unlocked {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        .achievement-icon {
            font-size: 24px;
        }

        .achievement-info {
            flex-grow: 1;
        }

        .achievement-name {
            color: #ffeb3b;
            margin-bottom: 5px;
        }

        .achievement-description {
            color: #ccc;
            font-size: 12px;
        }

        .modal h2 {
            color: #ffeb3b;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 2px 2px 0px #000;
        }

        .credits {
            position: fixed;
            bottom: 10px;
            left: 10px;
            color: #666;
            font-size: 12px;
        }

        .reset-save-btn {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid rgba(255, 0, 0, 0.3);
            color: #ff4444;
            padding: 5px 10px;
            border-radius: 0;
            cursor: pointer;
            font-family: 'Press Start 2P', monospace;
            font-size: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.5);
            image-rendering: pixelated;
        }

        .reset-save-btn:hover {
            background: rgba(255, 0, 0, 0.2);
            border-color: rgba(255, 0, 0, 0.5);
            transform: translateY(-1px);
        }

        .reset-save-btn:active {
            transform: translateY(1px);
        }

        .reset-confirm-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            border: 3px solid #ff4444;
            padding: 20px;
            border-radius: 0;
            text-align: center;
            z-index: 1000;
            font-family: 'Press Start 2P', monospace;
            image-rendering: pixelated;
        }

        .reset-confirm-modal h3 {
            color: #ff4444;
            margin: 0 0 15px 0;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.5);
        }

        .reset-confirm-modal p {
            color: #fff;
            margin: 0 0 20px 0;
            font-size: 8px;
            line-height: 1.5;
            text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.5);
        }

        .reset-confirm-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .reset-confirm-btn {
            padding: 10px 15px;
            border: 2px solid;
            border-radius: 0;
            cursor: pointer;
            font-family: 'Press Start 2P', monospace;
            font-size: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.2s;
            text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.5);
        }

        .reset-confirm-yes {
            background: #ff4444;
            color: white;
            border-color: #ff0000;
        }

        .reset-confirm-yes:hover {
            background: #ff0000;
            transform: translateY(-1px);
        }

        .reset-confirm-yes:active {
            transform: translateY(1px);
        }

        .reset-confirm-no {
            background: #444;
            color: white;
            border-color: #666;
        }

        .reset-confirm-no:hover {
            background: #666;
            transform: translateY(-1px);
        }

        .reset-confirm-no:active {
            transform: translateY(1px);
        }

        .character-unlock-popup .character-name {
            color: #ffd700;
            font-size: 10px;
            margin: 5px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .character-unlock-popup .character-hint {
            font-size: 7px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <h1>🦖 DINO RUNNER 🦖</h1>
    <div id="title-screen">
        <div id="high-score-display">High Score: 0</div>
        <div id="character-select">
            <h3>Select Character</h3>
            <div class="character-grid">
            </div>
        </div>
        <button id="start-game" style="display: none;">Select a character to start!</button>
        <div class="menu-buttons">
            <button class="menu-button" id="achievements-btn">View Achievements</button>
            <button class="menu-button" id="leaderboard-btn">View Leaderboard</button>
        </div>
    </div>
    <div id="game-container" style="display: none;">
        <p>Press SPACEBAR to jump!</p>
        <div id="game-area">
            <div class="bg-layer bg-sky"></div>
            <div class="bg-layer bg-clouds"></div>
            <div class="bg-layer bg-night"></div>
            <div id="dino"></div>
            <div id="obstacle"></div>
            <div id="milestone-popup">
                <div class="milestone-score">🎉 100 POINTS! 🎉</div>
                <div class="milestone-message">Keep going!</div>
            </div>
            <div id="game-overlay">
                <div class="game-over-text">GAME OVER</div>
                <div class="game-over-score">Score: 0</div>
                <div class="game-over-message">Press SPACE to play again</div>
            </div>
        </div>
        <div id="score">Score: 0</div>
        <button id="back-to-menu" style="display: none;">Back to Menu</button>
    </div>
    <div id="credits">Created by Jacob Graham © 2025</div>
    <button id="reset-save-btn" class="reset-save-btn">
        <span style="font-size: 12px;">🗑️</span> RESET
    </button>
    <div id="reset-confirm-modal" class="reset-confirm-modal">
        <h3>Reset Game Progress?</h3>
        <p>This will delete all your achievements, unlocked characters, and high scores. This cannot be undone!</p>
        <div class="reset-confirm-buttons">
            <button class="reset-confirm-btn reset-confirm-yes">Yes, Reset Everything</button>
            <button class="reset-confirm-btn reset-confirm-no">No, Keep Progress</button>
        </div>
    </div>

    <div id="achievements-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close">×</span>
            <h2>Achievements</h2>
            <div id="achievements-list" class="achievement-list">
            </div>
        </div>
    </div>

    <div id="leaderboard-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close">×</span>
            <h2>Leaderboard</h2>
            <div id="modal-leaderboard-list" class="score-list">
            </div>
        </div>
    </div>

    <div id="character-unlock-popup" class="character-unlock-popup">
        <h3>New Character Unlocked!</h3>
        <div class="character-icon"></div>
        <p class="character-name"></p>
        <p class="character-hint">Check the character select screen</p>
    </div>

    <div id="achievement-popup" class="achievement-popup">
        <h3>Achievement Unlocked!</h3>
        <p class="achievement-name"></p>
        <p class="achievement-description"></p>
    </div>

    <script>
        const dino = document.getElementById('dino');
        const obstacle = document.getElementById('obstacle');
        const gameArea = document.getElementById('game-area');
        const scoreDisplay = document.getElementById('score');
        const titleScreen = document.getElementById('title-screen');
        const gameContainer = document.getElementById('game-container');
        const highScoreDisplay = document.getElementById('high-score-display');
        const leaderboardList = document.getElementById('leaderboard-list');
        const backToMenuBtn = document.getElementById('back-to-menu');
        const milestonePopup = document.getElementById('milestone-popup');

        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function generateJumpSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(660, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(220, audioContext.currentTime + 0.2);
            gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.25, audioContext.currentTime + 0.05);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.2);
        }

        function generateMilestoneSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.type = 'square';
            oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(880, audioContext.currentTime + 0.1);
            oscillator.frequency.setValueAtTime(1320, audioContext.currentTime + 0.2);
            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime + 0.2);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        function generateGameOverSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(220, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(55, audioContext.currentTime + 0.5);
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        let isJumping = false;
        let isGameOver = false;
        let isInGame = false;
        let score = 0;
        let lastMilestone = 0;
        let jumpCount = 0;

        let gameLoopId = null;
        let lastTimestamp = 0;
        let scoreUpdateAccumulator = 0;
        const SCORE_INTERVAL_MS = 100;


        const milestoneMessages = {
            100: "You're getting started!",
            200: "You're on fire!",
            300: "Incredible progress!",
            400: "You're unstoppable!",
            500: "Legendary performance!",
            600: "You're a dino master!",
            700: "Absolutely amazing!",
            800: "You're breaking records!",
            900: "Almost to 1000!",
            1000: "You're a true champion!"
        };

        let highScore = 0;
        let leaderboard = []; 

        const obstacleTypes = [
            {
                name: "cactus_small_single",
                width: 20, height: 40,
                svg: `<svg width="20" height="40" xmlns="http://www.w3.org/2000/svg">
                    <rect x="8" y="0" width="4" height="40" fill="#2E7D32"/>
                    <rect x="2" y="10" width="6" height="4" fill="#388E3C"/>
                    <rect x="2" y="14" width="4" height="8" fill="#2E7D32"/>
                    <rect x="12" y="15" width="6" height="4" fill="#388E3C"/>
                    <rect x="14" y="19" width="4" height="8" fill="#2E7D32"/>
                </svg>`
            },
            {
                name: "cactus_tall_slim",
                width: 25, height: 55,
                svg: `<svg width="25" height="55" xmlns="http://www.w3.org/2000/svg">
                    <rect x="10" y="0" width="5" height="55" fill="#1B5E20"/>
                    <rect x="2" y="20" width="8" height="5" fill="#2E7D32"/>
                    <rect x="2" y="25" width="5" height="10" fill="#1B5E20"/>
                    <rect x="15" y="30" width="8" height="5" fill="#2E7D32"/>
                    <rect x="18" y="35" width="5" height="12" fill="#1B5E20"/>
                </svg>`
            },
            {
                name: "cactus_wide_short",
                width: 45, height: 30,
                svg: `<svg width="45" height="30" xmlns="http://www.w3.org/2000/svg">
                    <rect x="20" y="0" width="5" height="30" fill="#2E7D32"/>
                    <rect x="5" y="5" width="15" height="5" fill="#388E3C"/>
                    <rect x="5" y="10" width="5" height="15" fill="#2E7D32"/>
                    <rect x="25" y="5" width="15" height="5" fill="#388E3C"/>
                    <rect x="35" y="10" width="5" height="15" fill="#2E7D32"/>
                </svg>`
            },
            {
                name: "cactus_double_short",
                width: 50, height: 35,
                svg: `<svg width="50" height="35" xmlns="http://www.w3.org/2000/svg">
                    <rect x="8" y="0" width="4" height="35" fill="#1B5E20"/>
                    <rect x="2" y="8" width="6" height="3" fill="#2E7D32"/>
                    <rect x="2" y="11" width="4" height="7" fill="#1B5E20"/>
                    <rect x="38" y="0" width="4" height="35" fill="#1B5E20"/>
                    <rect x="42" y="12" width="6" height="3" fill="#2E7D32"/>
                    <rect x="44" y="15" width="4" height="7" fill="#1B5E20"/>
                </svg>`
            }
        ];

        let currentObstacleProps = null;

        function jump() {
            if (isJumping || isGameOver) return;
            isJumping = true;
            jumpCount++; 
            
            if (jumpCount === 50 && !achievements['jump_master'].unlocked) {
                unlockAchievement('jump_master');
            }
            
            dino.classList.add('jump');
            generateJumpSound();
            setTimeout(() => {
                dino.classList.remove('jump');
                isJumping = false;
            }, 500);
        }

        document.addEventListener('keydown', function(event) {
            if (event.code === 'Space') {
                event.preventDefault(); 
                
                if (isGameOver) {
                    startGame();
                } else if (isInGame) {
                    jump();
                }
            }
        });

        backToMenuBtn.addEventListener('click', function() {
            showTitleScreen();
        });

        function showTitleScreen() {
            const titleScreen = document.getElementById('title-screen');
            const gameContainer = document.getElementById('game-container');
            
            if (titleScreen) {
                titleScreen.style.display = 'block';
            }
            
            if (gameContainer) {
                gameContainer.style.display = 'none';
            }
            isInGame = false;
            if (gameLoopId) {
                cancelAnimationFrame(gameLoopId);
                gameLoopId = null;
            }

            requestAnimationFrame(() => {
                updateLeaderboardDisplay();
            });
        }

        function showGame() {
            isInGame = true;
            titleScreen.style.display = 'none';
            gameContainer.style.display = 'block';
        }

        function updateHighScoreDisplay() {
            highScoreDisplay.textContent = `High Score: ${highScore}`;
        }

        function updateLeaderboardDisplay() {
            const leaderboardElement = document.getElementById('leaderboard-list');
            const modalLeaderboardList = document.getElementById('modal-leaderboard-list');
            
            function generateLeaderboardHTML(scores) {
                if (!scores || scores.length === 0) {
                    return '<div class="score-entry">No scores yet - be the first!</div>';
                }
                return scores
                    .slice(0, 10)
                    .map((score, index) => {
                        const rank = index + 1;
                        const medals = ['🥇', '🥈', '🥉'];
                        const medal = medals[index] || `${rank}.`;
                        return `
                            <div class="score-entry">
                                <span class="score-rank">${medal}</span>
                                <span class="score-value">${score}</span>
                            </div>
                        `;
                    })
                    .join('');
            }

            if (leaderboardElement) {
                leaderboardElement.innerHTML = generateLeaderboardHTML(leaderboard);
            }

            if (modalLeaderboardList) {
                modalLeaderboardList.innerHTML = generateLeaderboardHTML(leaderboard);
            }
            updateHighScoreDisplay();
        }

        function addToLeaderboard(newScore) {
            leaderboard.push(newScore);  
            leaderboard.sort((a, b) => b - a);
            leaderboard = leaderboard.slice(0, 10);
            if (newScore > highScore) {
                highScore = newScore;
                updateHighScoreDisplay();
            }
        }

        function spawnNewObstacle() {
            const randomIndex = Math.floor(Math.random() * obstacleTypes.length);
            currentObstacleProps = obstacleTypes[randomIndex];

            if (!currentObstacleProps || typeof currentObstacleProps.width === 'undefined' || typeof currentObstacleProps.svg === 'undefined') {
                return;
            }

            obstacle.style.animation = 'none';
            obstacle.style.right = `-100px`;
            
            obstacle.style.width = `${currentObstacleProps.width}px`;
            obstacle.style.height = `${currentObstacleProps.height}px`;
            
            const svgDataUrl = 'data:image/svg+xml,' + encodeURIComponent(currentObstacleProps.svg);
            obstacle.style.backgroundImage = `url("${svgDataUrl}")`;
            obstacle.style.backgroundSize = 'contain';
            obstacle.style.backgroundRepeat = 'no-repeat';

            obstacle.offsetHeight;

            obstacle.style.animation = 'obstacle-move 2s linear infinite';
            obstacle.style.animationPlayState = 'running';
        }

        function checkGameLogic() {
            if (isGameOver) return;

            const dinoRect = dino.getBoundingClientRect();
            const obstacleRect = obstacle.getBoundingClientRect();

            const horizontalBuffer = 5;
            const verticalBuffer = 5;

            const horizontalOverlap = dinoRect.right - horizontalBuffer > obstacleRect.left &&
                                      dinoRect.left + horizontalBuffer < obstacleRect.right;
            const verticalOverlap = dinoRect.bottom - verticalBuffer > obstacleRect.top &&
                                    dinoRect.top + verticalBuffer < obstacleRect.bottom;

            if (horizontalOverlap && verticalOverlap) {
                gameOver();
                return;
            }

            const gameAreaRect = gameArea.getBoundingClientRect();
            if (obstacleRect.right < gameAreaRect.left && currentObstacleProps) {
                spawnNewObstacle();
            }
        }

        function showMilestonePopup(points) {
            if (isGameOver) return;
            
            const message = milestoneMessages[points] || "Keep going!";
            const scoreElement = milestonePopup.querySelector('.milestone-score');
            const messageElement = milestonePopup.querySelector('.milestone-message');
            
            scoreElement.textContent = `🎉 ${points} POINTS! 🎉`;
            messageElement.textContent = message;
            
            generateMilestoneSound();
            
            milestonePopup.classList.remove('animate');
            milestonePopup.offsetHeight;
            milestonePopup.classList.add('animate');
            
            setTimeout(() => {
                if (!isGameOver) {
                    milestonePopup.classList.remove('animate');
                }
            }, 2000);
        }

        function _incrementScoreAndUpdateDisplay() {
            score++;
            scoreDisplay.textContent = `Score: ${score}`;
        }

        function _checkAndUpdateHighScore() {
            if (score > highScore) {
                highScore = score;
                updateHighScoreDisplay();
            }
        }

        function _checkScoreBasedAchievements() {
            if (score === 100 && achievements['score_100'] && !achievements['score_100'].unlocked) {
                unlockAchievement('score_100');
            } else if (score === 500 && achievements['score_500'] && !achievements['score_500'].unlocked) {
                unlockAchievement('score_500');
            } else if (score === 1000 && achievements['score_1000'] && !achievements['score_1000'].unlocked) {
                unlockAchievement('score_1000');
            }
        }
        
        function _checkMilestones() {
            if (score % 100 === 0 && score > lastMilestone && !isGameOver) {
                lastMilestone = score;
                showMilestonePopup(score);
            }
        }
        
        function _updateDayNightCycle() {
            if (window.updateDayNightCycle) window.updateDayNightCycle(score);
        }


        function gameOver() {
            if (isGameOver) return;
            isGameOver = true;
            isInGame = false; 

            if (gameLoopId) {
                cancelAnimationFrame(gameLoopId);
                gameLoopId = null;
            }

            if (obstacle) {
                obstacle.style.animationPlayState = 'paused';
            }
            
            unlockAchievement('first_death');
            
            generateGameOverSound();

            const gameOverlay = document.getElementById('game-overlay');
            const gameOverText = gameOverlay.querySelector('.game-over-text');
            const gameOverScore = gameOverlay.querySelector('.game-over-score');
            const gameOverMessage = gameOverlay.querySelector('.game-over-message');

            if (score > 0) {
                addToLeaderboard(score);
                
                let message = 'Press SPACE to play again';
                if (score === highScore && score > 0) {
                    message = '🎉 NEW HIGH SCORE! Press SPACE to play again';
                    gameOverText.textContent = 'NEW HIGH SCORE!';
                } else if (leaderboard.indexOf(score) < 3 && leaderboard.length > 1) {
                    message = '🏆 TOP 3 SCORE! Press SPACE to play again';
                    gameOverText.textContent = 'TOP 3 SCORE!';
                } else {
                    gameOverText.textContent = 'GAME OVER';
                }
                
                gameOverScore.textContent = `Score: ${score}`;
                gameOverMessage.textContent = message;
            } else {
                gameOverText.textContent = 'GAME OVER';
                gameOverScore.textContent = 'Score: 0';
                gameOverMessage.textContent = 'Press SPACE to play again';
            }
            
            gameOverlay.classList.add('show');
            backToMenuBtn.style.display = 'inline-block';
        }
        
        function gameLoop(timestamp) {
            if (isGameOver || !isInGame) {
                 if (gameLoopId) cancelAnimationFrame(gameLoopId);
                 gameLoopId = null;
                 return;
            }

            const deltaTime = timestamp - lastTimestamp;
            lastTimestamp = timestamp;

            checkGameLogic();

            scoreUpdateAccumulator += deltaTime;
            if (scoreUpdateAccumulator >= SCORE_INTERVAL_MS) {
                _incrementScoreAndUpdateDisplay();
                _checkAndUpdateHighScore();
                _checkScoreBasedAchievements();
                _checkMilestones();
                _updateDayNightCycle();
                scoreUpdateAccumulator -= SCORE_INTERVAL_MS; 
            }
            gameLoopId = requestAnimationFrame(gameLoop);
        }


        function startGame() {
            titleScreen.style.display = 'none';
            gameContainer.style.display = 'block';
            isInGame = true;
            isGameOver = false;
            isJumping = false;
            score = 0;
            jumpCount = 0; 
            lastMilestone = 0;
            scoreDisplay.textContent = `Score: ${score}`;
            backToMenuBtn.style.display = 'none';
            
            document.getElementById('game-overlay').classList.remove('show');
            document.getElementById('milestone-popup').classList.remove('animate');
            
            dino.classList.remove('jump');
            dino.style.bottom = '30px';

            spawnNewObstacle(); 

            if (gameLoopId) {
                cancelAnimationFrame(gameLoopId);
            }
            lastTimestamp = performance.now();
            scoreUpdateAccumulator = 0;
            gameLoopId = requestAnimationFrame(gameLoop);
        }

        showTitleScreen();

        const characterTypes = {
            default: {
                name: "Classic Dino",
                unlocked: true,
                svg: `<svg width="40" height="50" xmlns="http://www.w3.org/2000/svg">
                    <rect x="0" y="20" width="5" height="5" fill="#228B22"/>
                    <rect x="5" y="25" width="5" height="5" fill="#228B22"/>
                    <rect x="5" y="15" width="20" height="15" fill="#228B22"/>
                    <rect x="10" y="30" width="5" height="20" fill="#228B22"/>
                    <rect x="20" y="30" width="5" height="20" fill="#228B22"/>
                    <rect x="25" y="10" width="5" height="10" fill="#228B22"/>
                    <rect x="25" y="0" width="15" height="10" fill="#228B22"/>
                    <rect x="35" y="2" width="3" height="3" fill="#FFF"/>
                    <rect x="38" y="6" width="2" height="2" fill="#000"/>
                </svg>`
            },
            raptor: {
                name: "Raptor",
                unlocked: false,
                requirement: "score_500",
                svg: `<svg width="40" height="50" xmlns="http://www.w3.org/2000/svg">
                    <rect x="0" y="20" width="5" height="5" fill="#8B4513"/>
                    <rect x="5" y="25" width="5" height="5" fill="#8B4513"/>
                    <rect x="5" y="15" width="20" height="15" fill="#8B4513"/>
                    <rect x="10" y="30" width="5" height="20" fill="#8B4513"/>
                    <rect x="20" y="30" width="5" height="20" fill="#8B4513"/>
                    <rect x="25" y="10" width="5" height="10" fill="#8B4513"/>
                    <rect x="25" y="0" width="15" height="10" fill="#8B4513"/>
                    <rect x="35" y="2" width="3" height="3" fill="#FF0000"/>
                    <rect x="38" y="6" width="2" height="2" fill="#000"/>
                </svg>`
            },
            robot: {
                name: "Robot Dino",
                unlocked: false,
                requirement: "achievement_5",
                svg: `<svg width="40" height="50" xmlns="http://www.w3.org/2000/svg">
                    <rect x="0" y="20" width="5" height="5" fill="#808080"/>
                    <rect x="5" y="25" width="5" height="5" fill="#808080"/>
                    <rect x="5" y="15" width="20" height="15" fill="#808080"/>
                    <rect x="10" y="30" width="5" height="20" fill="#808080"/>
                    <rect x="20" y="30" width="5" height="20" fill="#808080"/>
                    <rect x="25" y="10" width="5" height="10" fill="#808080"/>
                    <rect x="25" y="0" width="15" height="10" fill="#808080"/>
                    <rect x="35" y="2" width="3" height="3" fill="#00FF00"/>
                    <rect x="38" y="6" width="2" height="2" fill="#000"/>
                </svg>`
            }
        };

        const achievements = {
            score_100: {
                id: "score_100",
                name: "Getting Started",
                description: "Reach 100 points",
                unlocked: false,
                icon: "🎯"
            },
            score_500: {
                id: "score_500",
                name: "Dino Master",
                description: "Reach 500 points",
                unlocked: false,
                icon: "🏆"
            },
            score_1000: {
                id: "score_1000",
                name: "Dino Legend",
                description: "Reach 1000 points",
                unlocked: false,
                icon: "👑"
            },
            first_death: {
                id: "first_death",
                name: "First Fall",
                description: "Experience your first game over",
                unlocked: false,
                icon: "💀"
            },
            jump_master: {
                id: "jump_master",
                name: "Jump Master",
                description: "Jump 50 times in one game",
                unlocked: false,
                icon: "🦘"
            }
        };

        let currentCharacter = 'default';
        let unlockedAchievements = new Set();

        function unlockAchievement(achievementId) {
            if (!achievements[achievementId] || achievements[achievementId].unlocked) {
                return;
            }
            achievements[achievementId].unlocked = true;
            unlockedAchievements.add(achievementId);
            
            let aCharWasUnlocked = false;
            Object.entries(characterTypes).forEach(([charId, char]) => {
                if (!char.unlocked && char.requirement) {
                    let shouldUnlock = false;
                    if (char.requirement.startsWith('score_')) {
                        const requiredScore = parseInt(char.requirement.split('_')[1]);
                        if (score >= requiredScore) { shouldUnlock = true; }
                    } else if (char.requirement.startsWith('achievement_')) {
                        const requiredCount = parseInt(char.requirement.split('_')[1]);
                        const unlockedCount = Object.values(achievements).filter(a => a.unlocked).length;
                        if (unlockedCount >= requiredCount) { shouldUnlock = true; }
                    } else if (char.requirement === achievementId) { shouldUnlock = true; }
                    
                    if (shouldUnlock) {
                        char.unlocked = true;
                        showCharacterUnlockPopup(charId);
                        aCharWasUnlocked = true;
                    }
                }
            });

            const ach = achievements[achievementId];
            if (aCharWasUnlocked) {
                setTimeout(() => { showAchievementPopup(achievementId, ach.name, ach.description); }, 3500);
            } else {
                showAchievementPopup(achievementId, ach.name, ach.description);
            }
            saveGameProgress();
            initializeCharacterSelect();
        }


        function showCharacterUnlockPopup(characterId) {
            const character = characterTypes[characterId];
            const popup = document.getElementById('character-unlock-popup');
            const icon = popup.querySelector('.character-icon');
            icon.style.backgroundImage = `url('data:image/svg+xml,${encodeURIComponent(character.svg)}')`; 
            popup.querySelector('.character-name').textContent = character.name;
            popup.classList.add('show');

            setTimeout(() => {
                popup.classList.remove('show');
            }, 3000);
        }

        function selectCharacter(characterId) {
            if (!characterTypes[characterId]) {
                return;
            }
            if (!characterTypes[characterId].unlocked) {
                return;
            }

            document.querySelectorAll('.character-option').forEach(option => {
                option.classList.remove('selected');
            });
            const selectedOption = document.querySelector(`.character-option[data-character-id="${characterId}"]`);
            if (selectedOption) {
                selectedOption.classList.add('selected');
            }

            currentCharacter = characterId;
            const character = characterTypes[characterId];
            const svgDataUrl = 'data:image/svg+xml,' + encodeURIComponent(character.svg);
            const dino = document.getElementById('dino');
            if (dino) {
                dino.style.backgroundImage = `url("${svgDataUrl}")`;
            }
            updateStartButton();
            saveGameProgress();
        }

        function updateStartButton() {
            const startGameBtn = document.getElementById('start-game');
            if (startGameBtn) {
                if (currentCharacter) {
                    startGameBtn.style.display = 'inline-block';
                    startGameBtn.disabled = false;
                    startGameBtn.textContent = 'Click to Start!';
                } else {
                    startGameBtn.style.display = 'none';
                }
            }
        }

        function saveGameProgress() {
            try {
                const progress = {
                    currentCharacter: currentCharacter,
                    achievements: Object.fromEntries(
                        Object.entries(achievements).map(([id, achievement]) => [id, achievement.unlocked])
                    ),
                    leaderboard: leaderboard,
                    highScore: typeof highScore !== 'undefined' ? highScore : 0,
                    characters: Object.fromEntries(
                        Object.entries(characterTypes).map(([id, char]) => [id, char.unlocked])
                    )
                };
                localStorage.setItem('dinoGameProgress', JSON.stringify(progress));
            } catch (error) {
                // error saving
            }
        }

        function loadGameProgress() {
            try {
                const savedProgress = localStorage.getItem('dinoGameProgress');
                if (savedProgress) {
                    const progress = JSON.parse(savedProgress);
                    
                    if (progress.achievements) {
                        Object.entries(progress.achievements).forEach(([id, unlocked]) => {
                            if (achievements[id]) {
                                achievements[id].unlocked = unlocked;
                                if(unlocked) unlockedAchievements.add(id);
                            }
                        });
                    }
                    
                    if (progress.currentCharacter && characterTypes[progress.currentCharacter]) {
                        currentCharacter = progress.currentCharacter;
                        const character = characterTypes[currentCharacter];
                        const svgDataUrl = 'data:image/svg+xml,' + encodeURIComponent(character.svg);
                        const dino = document.getElementById('dino');
                        if (dino) {
                            dino.style.backgroundImage = `url("${svgDataUrl}")`;
                        }
                    }
                    
                    if (progress.leaderboard) {
                        leaderboard = progress.leaderboard;
                    }
                    
                    if (typeof progress.highScore !== 'undefined') {
                        highScore = progress.highScore;
                        updateHighScoreDisplay();
                    }
                    
                    if (progress.characters) {
                        Object.entries(progress.characters).forEach(([id, unlocked]) => {
                            if (characterTypes[id]) {
                                characterTypes[id].unlocked = unlocked;
                            }
                        });
                    }
                }
            } catch (error) {
                // error loading
            }
        }

        function initializeAchievements() {
            const achievementsBtn = document.getElementById('achievements-btn');
            if (achievementsBtn) {
                achievementsBtn.replaceWith(achievementsBtn.cloneNode(true));
                const newAchievementsBtn = document.getElementById('achievements-btn');
                
                newAchievementsBtn.addEventListener('click', function() {
                    const modal = document.getElementById('achievements-modal');
                    const achievementsList = document.getElementById('achievements-list');
                    if (modal && achievementsList) {
                        const achievementsHTML = Object.values(achievements)
                            .map(achievement => `
                                <div class="achievement-item ${achievement.unlocked ? 'unlocked' : ''}">
                                    <div class="achievement-icon">${achievement.icon}</div>
                                    <div class="achievement-info">
                                        <div class="achievement-name">${achievement.name}</div>
                                        <div class="achievement-description">${achievement.description}</div>
                                    </div>
                                </div>
                            `).join('');
                        
                        achievementsList.innerHTML = achievementsHTML;
                        modal.style.display = 'block';
                    }
                });
            }
        }

        function initializeLeaderboard() {
            const leaderboardBtn = document.getElementById('leaderboard-btn');
            if (leaderboardBtn) {
                leaderboardBtn.replaceWith(leaderboardBtn.cloneNode(true));
                const newLeaderboardBtn = document.getElementById('leaderboard-btn');
                
                newLeaderboardBtn.addEventListener('click', function() {
                    const modal = document.getElementById('leaderboard-modal');
                    const leaderboardList = document.getElementById('modal-leaderboard-list');
                    if (modal && leaderboardList) {
                        updateLeaderboardDisplay();
                        modal.style.display = 'block';
                    }
                });
            }
        }

        function initializeCharacterSelect() {
            const characterGrid = document.querySelector('.character-grid');
            if (!characterGrid) {
                return;
            }
            characterGrid.innerHTML = '';
            
            Object.entries(characterTypes).forEach(([id, char]) => {
                const option = document.createElement('div');
                option.className = `character-option ${char.unlocked ? 'unlocked' : 'locked'} ${id === currentCharacter ? 'selected' : ''}`;
                option.dataset.characterId = id;
                
                const preview = document.createElement('div');
                preview.className = 'character-preview';
                preview.innerHTML = char.svg;
                
                const name = document.createElement('div');
                name.className = 'character-name';
                name.textContent = char.name;
                
                option.appendChild(preview);
                option.appendChild(name);
                
                if (!char.unlocked) {
                    const lock = document.createElement('div');
                    lock.className = 'character-locked';
                    lock.textContent = '🔒';
                    option.appendChild(lock);

                    const tooltip = document.createElement('div');
                    tooltip.className = 'character-tooltip';
                    
                    let requirementText = 'Locked';
                    if (char.requirement) {
                        if (char.requirement.startsWith('score_')) {
                            const scoreReq = char.requirement.split('_')[1];
                            requirementText = `Reach ${scoreReq} points to unlock`;
                        } else if (char.requirement.startsWith('achievement_')) {
                            const achievementCount = char.requirement.split('_')[1];
                            requirementText = achievementCount === '5' ? 
                                'Unlock ALL achievements to unlock' : 
                                `Unlock ${achievementCount} achievements to unlock`;
                        } else if (achievements[char.requirement]) {
                             requirementText = `Unlock "${achievements[char.requirement].name}" achievement`;
                        }
                    }
                    tooltip.textContent = requirementText;
                    option.appendChild(tooltip);
                }
                
                if (char.unlocked) {
                    option.addEventListener('click', () => {
                        selectCharacter(id);
                    });
                }
                characterGrid.appendChild(option);
            });
        }

        function resetGameProgress() {
            try {
                localStorage.removeItem('dinoGameProgress');
                currentCharacter = 'default';
                score = 0;
                highScore = 0;
                leaderboard = [];
                
                Object.values(achievements).forEach(achievement => {
                    achievement.unlocked = false;
                });
                unlockedAchievements.clear();
                
                Object.entries(characterTypes).forEach(([id, char]) => {
                    if (id !== 'default') {
                        char.unlocked = false;
                    } else {
                        char.unlocked = true; 
                    }
                });
                
                const dino = document.getElementById('dino');
                if (dino) {
                    const defaultChar = characterTypes.default;
                    const svgDataUrl = 'data:image/svg+xml,' + encodeURIComponent(defaultChar.svg);
                    dino.style.backgroundImage = `url("${svgDataUrl}")`;
                }
                
                initializeCharacterSelect();
                initializeAchievements();
                initializeLeaderboard();
                updateStartButton();
                updateHighScoreDisplay();
                
                titleScreen.style.display = 'block';
                gameContainer.style.display = 'none';
                
                const resetModal = document.getElementById('reset-confirm-modal');
                if (resetModal) {
                    resetModal.style.display = 'none';
                }
            } catch (error) {
                // error resetting
            }
        }

        function initializeResetButton() {
            const resetBtn = document.getElementById('reset-save-btn');
            const resetModal = document.getElementById('reset-confirm-modal');
            const confirmYes = resetModal.querySelector('.reset-confirm-yes');
            const confirmNo = resetModal.querySelector('.reset-confirm-no');
            
            if (resetBtn && resetModal && confirmYes && confirmNo) {
                resetBtn.addEventListener('click', () => {
                    resetModal.style.display = 'block';
                });
                
                confirmYes.addEventListener('click', () => {
                    resetGameProgress();
                });
                
                confirmNo.addEventListener('click', () => {
                    resetModal.style.display = 'none';
                });
                
                window.addEventListener('click', (event) => {
                    if (event.target === resetModal) {
                        resetModal.style.display = 'none';
                    }
                });
            }
        }

        function initializeGame() {
            loadGameProgress();
            initializeAchievements();
            initializeLeaderboard();
            initializeCharacterSelect();
            initializeResetButton();
            updateStartButton(); 
            
            const startGameBtn = document.getElementById('start-game');
            if (startGameBtn) {
                startGameBtn.addEventListener('click', function() {
                    if (currentCharacter) {
                        startGame();
                    }
                });
            }
            
            document.querySelectorAll('.modal-close').forEach(closeBtn => {
                closeBtn.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    if (modal) {
                        modal.style.display = 'none';
                    }
                });
            });
            
            window.addEventListener('click', (event) => {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            });
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeGame);
        } else {
            initializeGame();
        }

        (function() {
            const sky = document.querySelector('.bg-sky');
            const cloudsLayer = document.querySelector('.bg-clouds');
            const nightLayer = document.querySelector('.bg-night');
            let clouds = [];
            let isNight = false;
            
            function createClouds() {
                cloudsLayer.innerHTML = '';
                clouds = [];
                for (let i = 0; i < 3; i++) {
                    const cloud = document.createElement('div');
                    cloud.className = 'cloud';
                    cloud.style.left = (Math.random() * 500) + 'px';
                    cloud.style.top = (Math.random() * 40 + 10) + 'px';
                    cloudsLayer.appendChild(cloud);
                    clouds.push({el: cloud, speed: 0.1 + Math.random() * 0.1});
                }
            }
            function animateBackground() {
                clouds.forEach(cloud => {
                    let left = parseFloat(cloud.el.style.left);
                    left += cloud.speed;
                    if (left > 600) left = -48;
                    cloud.el.style.left = left + 'px';
                });
                requestAnimationFrame(animateBackground);
            }
            function updateDayNightCycleFn(currentScore) {
                const cycle = Math.floor(currentScore / 500) % 2;
                if (cycle !== (isNight ? 1 : 0)) {
                    isNight = !isNight;
                    if (isNight) {
                        nightLayer.classList.add('active');
                    } else {
                        nightLayer.classList.remove('active');
                    }
                    let sky1 = isNight ? '#22334a' : '#87ceeb';
                    let sky2 = isNight ? '#22334a' : '#87ceeb';
                    let ground = isNight ? '#bfa77a' : '#deb887';
                    sky.style.setProperty('--sky-color1', sky1);
                    sky.style.setProperty('--sky-color2', sky2);
                    sky.style.setProperty('--ground-color', ground);
                }
            }
            window.updateDayNightCycle = updateDayNightCycleFn;
            createClouds();
            animateBackground();
            let sky1 = '#87ceeb', sky2 = '#87ceeb', ground = '#deb887';
            sky.style.setProperty('--sky-color1', sky1);
            sky.style.setProperty('--sky-color2', sky2);
            sky.style.setProperty('--ground-color', ground);
        })();

        function showAchievementPopup(id, name, desc) {
            const popup = document.getElementById('achievement-popup');
            if (popup) {
                popup.querySelector('.achievement-name').textContent = name;
                popup.querySelector('.achievement-description').textContent = desc;
                popup.classList.add('show');
                setTimeout(() => { popup.classList.remove('show'); }, 3000);
            }
        }
    </script>
</body>
</html>
